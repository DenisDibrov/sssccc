

<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,400&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<script type="text/javascript" src="https://questunlock.com/assets/js/tablesort/tablesort.js"></script>
<script type="text/javascript" src="https://questunlock.com/assets/js/tablesort/sorts/tablesort.number.js"></script>
<link rel="shortcut icon" href="https://cdn.discordapp.com/attachments/838391521584611338/838718965051555880/subico.png">
<link rel="stylesheet" type="text/css" href="//questunlock.com/include/css/style.css?v=1">
<script type="text/javascript" src="https://questunlock.com/include/js/global.js?v=4"></script>
<title>Новая ссылка — questunlock.com</title>
<script data-ad-client="ca-pub-7301425691168226" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body>
<header>
<style type="text/css">
	
	:root
	{
		--topMenuHeight: 50px;
		--paddingBody: 20px;
	}

	.liveContent
	{
		padding-left: var(--paddingBody);
		padding-right: var(--paddingBody);
		max-width: 1040px;
		margin: auto;
	}

	#tm
	{
		background: var(--cp);
		width: 100%;
		min-height: var(--topMenuHeight);

		margin-bottom: var(--mB);
	}
	#tm > .content
	{
		display: grid;
		grid-template-columns: 1fr auto;

		font-weight: 400;
		color: white;
	}
	#tm > .content > .r > .item,
	#tm > .content > .l > .item
	{
		display: inline-flex;
		min-height: var(--topMenuHeight);
		align-items: center;
		justify-content: center;
	}
	#tm > .content > .r > .item
	{
		margin-left: 30px;
		color: white;
		text-decoration: none;
	}
	#tm > .content > .r > .item:hover
	{
		opacity: 90%;
		cursor: pointer;
	}
	.clg
	{
		color: white;
		font-weight: 500;
		text-decoration: none;
		cursor: pointer;
	}
	.clg:hover
	{
		color: white;
		text-decoration: underline;
		opacity: 90%;
	}
</style>
<div id="tm">
<div class="liveContent content unselect">
<div class="l">
<a class="item clg" href="/dash">QUESTUNLOCK</a>
</div>
<div class="r">
<style type="text/css">
				.lang_button
				{
					text-transform: capitalize;
				}
				.lang_button:hover
				{
					opacity: 80%;
					text-decoration: underline;
					cursor: pointer;
				}
				.lang_line
				{
					margin-left: 5px;
					margin-right: 5px;
				}
			</style>
<div class="item" style="opacity: 100%; cursor: default;">
<span onclick="set_lang('en');" class="lang_button">en</span>
</div>
<a class="item" href="https://vk.com/questunlock?w=wall-204516659_19" target="_blank">Гайд</a>
<a class="item" href="/logout">Выйти</a>
</div>
</div>
</div>
</header>
<div id="content" style="margin-bottom: 50px; padding-bottom: 50px;">
<style type="text/css">
	
	#mp > .buttons
	{
		min-height: 40px;
		border-radius: 20px;

		background: rgba(255,255,255,0.3);
		margin-bottom: var(--mB);
		
	}

	#mp > .buttons > .item
	{
		display: inline-flex;
		min-height: 40px;
		align-items: center;
		padding-left: 20px;
		padding-right: 20px;

		border-radius: 20px;
		margin: 0;
		color: var(--ci);

		text-decoration: none;
		cursor: pointer;
	}
	#mp > .buttons > .item:hover
	{
		opacity: 60%;
	}
	#mp > .buttons > .item.active
	{
		opacity: 100% !important;
		background: white;
		font-weight: 500;
		color: var(--ct);
		box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
	}

	.small_banner
	{
		background: white;
		padding: var(--mM);
		border-radius: 5px;
		box-shadow: var(--dsh);
		display: table;
		margin: auto;
		margin-bottom: var(--mB);
	}

</style>
<div class="liveContent">
<div class="small_banner">Не знаете, как создать ссылку? Смотрите <a href="https://vk.com/questunlock?w=wall-204516659_19" target="_blank">Видеоурок</a></div>
</div>
<div class="liveContent" id="mp">
<div class="buttons fitW unselect">
<a class="item" href="/dash" data-link="dash">Основное</a>
<a class="item" href="/dash/create" data-link="dash/create">Создать задание</a>
</div>
</div>
<script type="text/javascript">
	
	$(`a[data-link="dash/create"]`).addClass('active');

</script><style type="text/css">
	
	#create > .name
	{
		font-size: 24px;
		line-height: 30px;
		margin-bottom: var(--mB);
	}
		
	#create > .redirect,
	#create > .quests
	{
		margin-bottom: var(--mB);
	}
	.redirect > .name,
	.quests > .name,
	.create > .name
	{
		font-size: 18px;
		margin-bottom: var(--mS);
	}

	.redirect > .info,
	.quests > .info,
	.create > .info
	{
		color: var(--ci);
		margin-bottom: var(--mM);
	}	



	#create
	{
		position: relative;
	}
	#create > .placeLoad
	{
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: var(--cbg);
		opacity: 60%;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	
</style>
<div class="liveContent canLoad" id="create">
<div class="placeLoad"><div class="spinner-border spinner_def" role="status"><span class="sr-only"></span></div></div>
<div class="name">Настройте новую ссылку</div>
<div class="redirect">
<div class="name">Награда за выполнение</div>
<div class="info" style="max-width: 320px;">Выберите какая награда будет после выполнения заданий.</div>
<script type="text/javascript">
			
			function set_gift_type(e)
			{
				gift = $(e).val();
				if ( gift == 'link' ) 
				{
					$("#lr").removeClass('hide');
					$("#input_gif_text").addClass('hide');
				}
				else
				{
					$("#lr").addClass('hide');
					$("#input_gif_text").removeClass('hide');
				}
			}

		</script>
<div class="input_def" id="type_gift" style="margin-bottom: var(--mM);">
<select class="select_def select_platform" onchange="$(this).parent().removeClass('error'); set_gift_type(this)" id="type_gift_select">
<option selected="selected" disabled="disabled" val="noselect">Выберите тип награды</option>
<option value="link">Ссылка</option>
<option value="text">Текст</option>
</select>
<div class="error">Ошибка</div>
</div>
<div class="input_def hide" id="lr">
<input type="text" placeholder="Ссылка перенаправления" style="width: 100%; max-width: 500px;" autocomplete="off" maxlength="256">
<div class="error">Ошибка</div>
</div>
<div class="input_def hide" id="input_gif_text">
<textarea id="gift_text" class="area_def" maxlength="1024" placeholder="Напишите любое сообщение, оно будет показано человеку после выполнения всех заданий" style="width: 100%; max-width: 500px; height: 100px;"></textarea>
<div class="error">Ошибка</div>
</div>
</div>
<style type="text/css">
		
		.quests > .list > .item
		{
			margin-bottom: var(--mM);
			padding-left: 15px;
			border-left: 1px solid var(--cb);

			display: grid;
			max-width: 500px;
			grid-template-columns: 1fr 60px;
			grid-gap: var(--mM);
			border-radius: 0px 5px 5px 0px;
		}
		.quests > .list > .item:hover
		{
			background: rgb(0,0,0,0.01);
		}
		.quests > .list > .item > .data
		{
			padding: var(--mM);
		}
		.quests > .list > .item > .delete
		{
			border-radius: 0px 5px 5px 0px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;

			opacity: 0%;
			min-height: 40px;
		}
		@media (max-width: 600px)
		{
			.quests > .list > .item > .delete
			{
				opacity: 100%;
			}
		}

		.quests > .list > .item:hover .delete
		{
			opacity: 70%;
		}
		.quests > .list > .delete:active
		{
			opacity: 100%;
		}
		.quests > .list > .item > .delete:hover
		{
			background: rgb(0,0,0,0.02);
		}

		.quests > .list > .item > .data > .input_def,
		.quests > .list > .item > .data > select
		{
			margin-bottom: var(--mM);
		}
		.quests > .list > .item > .data > div:last-child
		{
			margin-bottom: 0;
		}
		.quests > .list > .item > .data > .input_def > input,
		.quests > .list > .item > .data > select
		{
			width: 100%;
		}
	</style>
<div class="quests">
<div class="name">Задания</div>
<div class="list" id="listQuests">
<div class="item quest_item quest_1">
<div class="data">
<select class="select_def select_platform" onchange="callbackInputs('p', this)">
<option selected="selected" disabled="disabled" val="noselect">Выберите сайт</option>
<option value="vk">Вконтакте</option>
<option value="instagram">Instagram</option>
<option value="telegram">Telegram</option>
<option value="youtube">Youtube</option>
<option value="other">Свой сайт</option>
</select>
<select class="select_def select_template hide" onchange="callbackInputs('t', this)">
<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>
</select>
<div class="input_def input_button">
<input type="text" placeholder="Название кнопки" maxlength="32">
<div class="error">Ошибка</div>
</div>
<div class="input_def input_link">
<input type="text" placeholder="Ссылка на веб-страницу" maxlength="256">
<div class="error">Ошибка</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
			
			var countQuests = 1;

			function addQuest($this)
			{
				if ( countQuests >= 9 ) $($this).addClass('hide');
				countQuests++;

				var idQ = 1;
				while ( true )
				{
					if ( !$(`.quest_${idQ}`).length ) break;

					idQ++;

					if ( idQ > 20 )
					{
						console.log('fatal!');
						break;
					}
				}
				var tmpO = `<div class="item quest_item quest_${idQ}">

								<div class="data">

									<select class="select_def select_platform" onchange="callbackInputs('p', this)">

										<option selected="selected" disabled="disabled" val="noselect">Выберите сайт</option>

										<option value="vk">Вконтакте</option>

										<option value="instagram">Instagram</option>

										<option value="telegram">Telegram</option>

										<option value="youtube">Youtube</option>
										
										<option value="other">Свой сайт</option>

									</select>

									<select class="select_def select_template hide" onchange="callbackInputs('t', this)">
										
										<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									</select>

									<div class="input_def input_button">
										
										<input type="text" placeholder="Название кнопки" maxlength="32">

										<div class="error"></div>

									</div>
									
									<div class="input_def input_link">
										
										<input type="text" placeholder="Ссылка на веб-страницу" maxlength="256">

										<div class="error"></div>

									</div>

								</div>

								<div class="delete" onclick="deleteQuest(${idQ})">

									<svg width="18" height="20" viewBox="0 0 18 20" fill="var(--ci)" xmlns="http://www.w3.org/2000/svg"><path d="M14 20H4C2.89543 20 2 19.1046 2 18V5H0V3H4V2C4 0.89543 4.89543 0 6 0H12C13.1046 0 14 0.89543 14 2V3H18V5H16V18C16 19.1046 15.1046 20 14 20ZM4 5V18H14V5H4ZM6 2V3H12V2H6ZM12 16H10V7H12V16ZM8 16H6V7H8V16Z" fill="var(--ci)"/></svg>

								</div>

							</div>`;

					$("#listQuests").append(tmpO);
					updateCountsQuests();
			}

			function updateCountsQuests()
			{
				$("#countQuests").text(countQuests);
			}

			function deleteQuest(id)
			{
				$(`.quest_${id}`).remove();
				countQuests--;
				updateCountsQuests();
				$("#addMore").removeClass('hide');
			}



			function submitQuest()
			{
				var type_gift = $("#type_gift_select").val();

				hideInputError('.input_def');
				$("#create").addClass('loading');

				var lr = $("#lr input").val();
				var gift_text = $("#gift_text").val();

				if ( type_gift == 'noselect' || !type_gift ) displayInputError('#type_gift', true, 'Выберите тип награды');
				else if ( type_gift == 'text' && gift_text.length <= 0 ) displayInputError('#input_gif_text', true, 'Введите текст для награды');
				else if ( type_gift == 'link' && !validateUrl(lr) ) displayInputError('#lr', true, 'Неправильная ссылка');
				else
				{
					var g = true;
					var la = {};

					$(".quest_item").each(function(i){
						console.log(i);
						var obj = $(this).children('.data');
						var platform = $(obj).children('.select_platform').val();
						var name = $(obj).children('.input_button').children('input').val();
						var link = $(obj).children('.input_link').children('input').val();

						if ( !validateUrl(link) )
						{
							displayInputError($(obj).children('.input_link'), true, 'Неправильная ссылка');
							g = false;
						}

						if ( !name )
						{
							displayInputError($(obj).children('.input_button'), true, 'Укажите название кнопки');
							g = false;
						}

						la[i] = {
							'platform': platform,
							'name': name,
							'link': link
						};
					});	
					if (g)
					{
						$.ajax({
						    type: 'POST',
						    url: '/ajax/user_post.php',
						    dataType: 'json',
						    data: { 'method': 'createNewQuestLink', 'data': la, 'redirect': lr, 'type_gift': type_gift, 'gift_text': gift_text },
						    success: function(r) 
						    { 
						    	console.log(r);
						    	if ( !r.ok )
						    	{
						    		alert(`Произошла неизвестная ошибка: ${r.details.reason.info}`);
						    	}
						    	else
						    	{
						    		location.href = `/dash?new=${r.domain}`;
						    	}
						    }
						});
					}
				}

				setTimeout(function(){$("#create").removeClass('loading')}, 500);
			}

			$(document).on('keypress',function(e) {
			    if(e.which == 13 && !$("textarea").is(":focus")) {
			        submitQuest();
			    }
			});



			function changeItemColor(i, p)
			{
				var c;
				switch(p)
				{
					case 'vk': c = '#4c75a3'; break;
					case 'instagram': c = '#e6683c'; break;
					case 'telegram': c = '#0088cc'; break;
					case 'youtube': c = '#FF0000'; break;
					case 'other': c = 'var(--cb)'; break;
				}
				$(i).attr('style', `border-left: 1px solid ${c}`);
			}

			function callbackInputs(p, $this)
			{
				var bData = $($this).parent();
				var bItem = $(bData).parent();
				var iTemplate = $(bData).children('.select_template');
				var iPlatform = $(bData).children('.select_platform');
				var bName = $(bData).children('.input_button');
				var iName = $(bName).children('input');

				if ( p == 'p' )
				{

					var	template = $($this).val();
					var tp;

					changeItemColor(bItem, template);

					$(iTemplate).removeClass('hide');

					switch(template)
					{
						case 'vk':

							tp = `<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									<option value="Поставить лайк">Поставить лайк</option>

									<option value="Подписаться">Подписаться</option>

									<option value="Оставить комментарий">Оставить комментарий</option>

									<option value="Сделать репост">Сделать репост</option>`;
							break;

						case 'instagram':

							tp = `<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									<option value="Подписаться">Подписаться</option>

									<option value="Поставить лайк">Поставить лайк</option>

									<option value="Оставить комментарий">Оставить комментарий</option>`;
							break;

						case 'telegram':

							tp = `<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									<option value="Подписаться">Подписаться</option>`;
							break;

						case 'youtube':

							tp = `<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									<option value="Поставить лайк">Поставить лайк</option>

									<option value="Подписаться">Подписаться</option>

									<option value="Подписаться + колокольчик">Подписаться + колокольчик</option>

									<option value="Колокольчик">Колокольчик</option>

									<option value="Оставить комментарий">Оставить комментарий</option>`;

							break;

						case 'other':

							tp = `<option selected="selected" disabled="disabled">Шаблон названия кнопки</option>

									<option value="Перейти">Перейти</option>

									<option value="Открыть">Открыть</option>

									<option value=""></option>`;
							break;

						default:

							$(iTemplate).addClass('hide');

							break;
					}

					$(iTemplate).html(tp);
				}
				else if ( p == 't' )
				{
					var template = $($this).val();
					$(iName).val(template);
				}
			}


		</script>
<div class="button def_btn grey" onclick="addQuest(this);" id="addMore">Добавить еще</div>
</div>
</div>
<div class="liveContent create">
<div class="name">Завершение</div>
<div class="info" style="max-width: 360px">Количество заданий: <span id="countQuests">1</span>. Если все готово — проверьте данные и нажмите на кнопку создания ссылки.</div>
<div class="def_btn purp" onclick="submitQuest()">Создать ссылку</div>
</div>
</div>
<footer>
</footer>
</body>
</html>
